/**********************************************************
***********************/
#include "AD9910.h"
#include "Delay.h"
/*-----------------------------------------------
  名称：AD9910串行驱动
  编写：Liu
  日期：2014.6
  修改：无
  内容：
------------------------------------------------*/

/* -------------- operation instruction --------------------
	 -------------- Freq_convert() 函数直接用于设置频率 ------
	 -------------- Amp_convert()  函数用于设置幅值     ------
*/

uchar cfr1[] = {0x00, 0x40, 0x00, 0x00};                              //cfr1控制字
uchar cfr2[] = {0x01, 0x00, 0x00, 0x00};                              //cfr2控制字
uchar cfr3[] = {0x15, 0x0F, 0x41, 0x32};                              //cfr3控制字  40M输入  25倍频  VC0=101   ICP=001;
uchar profile11[] = {0x3f, 0xff, 0x00, 0x00, 0x25, 0x09, 0x7b, 0x42}; //profile1控制字 0x25,0x09,0x7b,0x42
                                                                      //01振幅控制 23相位控制 4567频率调谐字



uchar ramprofile0[8] = {0x00}; //ramprofile0控制字
uchar drgparameter[20] = {0x00};



//uint32_t RAM_TEXT_FM[500]={
//	4000000,4004000,4008000,
//	4012000,4016000,4020000,
//	4024000,4028000,4032000,
//	4036000,4040000,4044000,
//	4048000,4052000,4056000,
//	4060000,4064000,4068000,
//	4072000,4076000,4080000,
//	4084000,4088000,4092000,
//	4096000,4100000,4104000,
//	4108000,4112000,4116000,
//	4120000,4124000,4128000,
//	4132000,4136000,4140000,
//	4144000,4148000,4152000,
//	4156000,4160000,4164000,
//	4168000,4172000,4176000,
//	4180000,4184000,4188000,
//	4192000,4196000,4200000,
//	4204000,4208000,4212000,
//	4216000,4220000,4224000,
//	4228000,4232000,4236000,
//	4240000,4244000,4248000,
//	4252000,4256000,4260000,
//	4264000,4268000,4272000,
//	4276000,4280000,4284000,
//	4288000,4292000,4296000,
//	4300000,4304000,4308000,
//	4312000,4316000,4320000,
//	4324000,4328000,4332000,
//	4336000,4340000,4344000,
//	4348000,4352000,4356000,
//	4360000,4364000,4368000,
//	4372000,4376000,4380000,
//	4384000,4388000,4392000,
//	4396000,4400000,4404000,
//	4408000,4412000,4416000,
//	4420000,4424000,4428000,
//	4432000,4436000,4440000,
//	4444000,4448000,4452000,
//	4456000,4460000,4464000,4468000,4472000,4476000,4480000,4484000,4488000,4492000,4496000,4500000,4504000,4508000,4512000,4516000,4520000,4524000,4528000,4532000,4536000,4540000,4544000,4548000,4552000,4556000,4560000,4564000,4568000,4572000,4576000,4580000,4584000,4588000,4592000,4596000,4600000,4604000,4608000,4612000,4616000,4620000,4624000,4628000,4632000,4636000,4640000,4644000,4648000,4652000,4656000,4660000,4664000,4668000,4672000,4676000,4680000,4684000,4688000,4692000,4696000,4700000,4704000,4708000,4712000,4716000,4720000,4724000,4728000,4732000,4736000,4740000,4744000,4748000,4752000,4756000,4760000,4764000,4768000,4772000,4776000,4780000,4784000,4788000,4792000,4796000,4800000,4804000,4808000,4812000,4816000,4820000,4824000,4828000,4832000,4836000,4840000,4844000,4848000,4852000,4856000,4860000,4864000,4868000,4872000,4876000,4880000,4884000,4888000,4892000,4896000,4900000,4904000,4908000,4912000,4916000,4920000,4924000,4928000,4932000,4936000,4940000,4944000,4948000,4952000,4956000,4960000,4964000,4968000,4972000,4976000,4980000,4984000,4988000,4992000,4996000,5000000,5004000,5008000,5012000,5016000,5020000,5024000,5028000,5032000,5036000,5040000,5044000,5048000,5052000,5056000,5060000,5064000,5068000,5072000,5076000,5080000,5084000,5088000,5092000,5096000,5100000,5104000,5108000,5112000,5116000,5120000,5124000,5128000,5132000,5136000,5140000,5144000,5148000,5152000,5156000,5160000,5164000,5168000,5172000,5176000,5180000,5184000,5188000,5192000,5196000,5200000,5204000,5208000,5212000,5216000,5220000,5224000,5228000,5232000,5236000,5240000,5244000,5248000,5252000,5256000,5260000,5264000,5268000,5272000,5276000,5280000,5284000,5288000,5292000,5296000,5300000,5304000,5308000,5312000,5316000,5320000,5324000,5328000,5332000,5336000,5340000,5344000,5348000,5352000,5356000,5360000,5364000,5368000,5372000,5376000,5380000,5384000,5388000,5392000,5396000,5400000,5404000,5408000,5412000,5416000,5420000,5424000,5428000,5432000,5436000,5440000,5444000,5448000,5452000,5456000,5460000,5464000,5468000,5472000,5476000,5480000,5484000,5488000,5492000,5496000,5500000,5504000,5508000,5512000,5516000,5520000,5524000,5528000,5532000,5536000,5540000,5544000,5548000,5552000,5556000,5560000,5564000,5568000,5572000,5576000,5580000,5584000,5588000,5592000,5596000,5600000,5604000,5608000,5612000,5616000,5620000,5624000,5628000,5632000,5636000,5640000,5644000,5648000,5652000,5656000,5660000,5664000,5668000,5672000,5676000,5680000,5684000,5688000,5692000,5696000,5700000,5704000,5708000,5712000,5716000,5720000,5724000,5728000,5732000,5736000,5740000,5744000,5748000,5752000,5756000,5760000,5764000,5768000,5772000,5776000,5780000,5784000,5788000,5792000,5796000,5800000,5804000,5808000,5812000,5816000,5820000,5824000,5828000,5832000,5836000,5840000,5844000,5848000,5852000,5856000,5860000,5864000,5868000,5872000,5876000,5880000,5884000,5888000,5892000,5896000,5900000,5904000,5908000,5912000,5916000,5920000,5924000,5928000,5932000,5936000,5940000,5944000,5948000,5952000,5956000,5960000,5964000,5968000,5972000,5976000,5980000,5984000,5988000,5992000,5996000
//};

uint32_t RAM_TEXT_FM[500]={
	
	

	
458500,464100,469700,474600,480200,485100,490700,496300,501200,506800,511700,517300,522200,527800,532700,538300,543200,548800,553700,559300,564200,569100,574700,579600,584500,590100,595000,599900,604800,609700,614600,619500,624400,629300,634200,639100,644000,648900,653800,658000,662900,667800,672000,676900,681100,686000,690200,695100,699300,703500,707700,711900,716800,721000,724500,728700,732900,737100,741300,744800,749000,752500,756700,760200,764400,767900,771400,774900,778400,781900,785400,788900,792400,795200,798700,801500,805000,807800,810600,814100,816900,819700,822500,825300,827400,830200,833000,835100,837900,840000,842100,844200,847000,849100,851200,852600,854700,856800,858200,860300,861700,863800,865200,866600,868000,869400,870800,871500,872900,874300,875000,876400,877100,877800,878500,879200,879900,880600,881300,881300,882000,882000,882000,882700,882700,882700,882700,882700,882000,882000,882000,881300,881300,880600,879900,879200,878500,877800,877100,876400,875000,874300,872900,871500,870800,869400,868000,866600,865200,863800,861700,860300,858200,856800,854700,852600,851200,849100,847000,844200,842100,840000,837900,835100,833000,830200,827400,825300,822500,819700,816900,814100,810600,807800,805000,801500,798700,795200,792400,788900,785400,781900,778400,774900,771400,767900,764400,760200,756700,752500,749000,744800,741300,737100,732900,728700,724500,721000,716800,711900,707700,703500,699300,695100,690200,686000,681100,676900,672000,667800,662900,658000,653800,648900,644000,639100,634200,629300,624400,619500,614600,609700,604800,599900,595000,590100,584500,579600,574700,569100,564200,559300,553700,548800,543200,538300,532700,527800,522200,517300,511700,506800,501200,496300,490700,485100,480200,474600,469700,464100,458500,453600,448000,443100,437500,431900,427000,421400,416500,410900,406000,400400,394800,389900,384300,379400,374500,368900,364000,358400,353500,348600,343000,338100,333200,327600,322700,317800,312900,308000,303100,298200,292600,288400,283500,278600,273700,268800,263900,259000,254800,249900,245700,240800,235900,231700,227500,222600,218400,214200,210000,205100,200900,196700,192500,189000,184800,180600,176400,172900,168700,164500,161000,157500,153300,149800,146300,142800,139300,135800,132300,128800,125300,122500,119000,116200,112700,109900,107100,103600,100800,98000,95200,92400,90300,87500,84700,82600,79800,77700,75600,72800,70700,68600,66500,65100,63000,60900,59500,57400,56000,53900,52500,51100,49700,48300,46900,45500,44800,43400,42700,41300,40600,39900,39200,38500,37800,37100,36400,36400,35700,35700,35000,35000,35000,35000,35000,35000,35000,35700,35700,36400,36400,37100,37800,38500,39200,39900,40600,41300,42700,43400,44800,45500,46900,48300,49700,51100,52500,53900,56000,57400,59500,60900,63000,65100,66500,68600,70700,72800,75600,77700,79800,82600,84700,87500,90300,92400,95200,98000,100800,103600,107100,109900,112700,116200,119000,122500,125300,128800,132300,135800,139300,142800,146300,149800,153300,157500,161000,164500,168700,172900,176400,180600,184800,189000,192500,196700,200900,205100,210000,214200,218400,222600,227500,231700,235900,240800,245700,249900,254800,259000,263900,268800,273700,278600,283500,288400,292600,298200,303100,308000,312900,317800,322700,327600,333200,338100,343000,348600,353500,358400,364000,368900,374500,379400,384300,389900,394800,400400,406000,410900,416500,421400,427000,431900,437500,443100,448000,453600,	
	
	
	
	
	

};
// fre data (ram model)


//高14位幅度控制
const unsigned char ramdata_Square[4096] = {
    //方波
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0xff,
    0xfc,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,

};

//高14位幅度控制
const unsigned char ramdata_Sawtooth[4096] = {
    //锯齿波
    0x00,
    0x00,
    0x00,
    0x00,
    0x03,
    0xfc,
    0x00,
    0x00,
    0x07,
    0xf8,
    0x00,
    0x00,
    0x0b,
    0xf4,
    0x00,
    0x00,
    0x0f,
    0xf0,
    0x00,
    0x00,
    0x13,
    0xec,
    0x00,
    0x00,
    0x17,
    0xe8,
    0x00,
    0x00,
    0x1b,
    0xe4,
    0x00,
    0x00,
    0x1f,
    0xe0,
    0x00,
    0x00,
    0x23,
    0xdc,
    0x00,
    0x00,
    0x27,
    0xd8,
    0x00,
    0x00,
    0x2b,
    0xd4,
    0x00,
    0x00,
    0x2f,
    0xd0,
    0x00,
    0x00,
    0x33,
    0xcc,
    0x00,
    0x00,
    0x37,
    0xc8,
    0x00,
    0x00,
    0x3b,
    0xc4,
    0x00,
    0x00,
    0x3f,
    0xc0,
    0x00,
    0x00,
    0x43,
    0xbc,
    0x00,
    0x00,
    0x47,
    0xb8,
    0x00,
    0x00,
    0x4b,
    0xb4,
    0x00,
    0x00,
    0x4f,
    0xb0,
    0x00,
    0x00,
    0x53,
    0xac,
    0x00,
    0x00,
    0x57,
    0xa8,
    0x00,
    0x00,
    0x5b,
    0xa4,
    0x00,
    0x00,
    0x5f,
    0xa0,
    0x00,
    0x00,
    0x63,
    0x9c,
    0x00,
    0x00,
    0x67,
    0x98,
    0x00,
    0x00,
    0x6b,
    0x94,
    0x00,
    0x00,
    0x6f,
    0x90,
    0x00,
    0x00,
    0x73,
    0x8c,
    0x00,
    0x00,
    0x77,
    0x88,
    0x00,
    0x00,
    0x7b,
    0x84,
    0x00,
    0x00,
    0x7f,
    0x80,
    0x00,
    0x00,
    0x83,
    0x7c,
    0x00,
    0x00,
    0x87,
    0x78,
    0x00,
    0x00,
    0x8b,
    0x74,
    0x00,
    0x00,
    0x8f,
    0x70,
    0x00,
    0x00,
    0x93,
    0x6c,
    0x00,
    0x00,
    0x97,
    0x68,
    0x00,
    0x00,
    0x9b,
    0x64,
    0x00,
    0x00,
    0x9f,
    0x60,
    0x00,
    0x00,
    0xa3,
    0x5c,
    0x00,
    0x00,
    0xa7,
    0x58,
    0x00,
    0x00,
    0xab,
    0x54,
    0x00,
    0x00,
    0xaf,
    0x50,
    0x00,
    0x00,
    0xb3,
    0x4c,
    0x00,
    0x00,
    0xb7,
    0x48,
    0x00,
    0x00,
    0xbb,
    0x44,
    0x00,
    0x00,
    0xbf,
    0x40,
    0x00,
    0x00,
    0xc3,
    0x3c,
    0x00,
    0x00,
    0xc7,
    0x38,
    0x00,
    0x00,
    0xcb,
    0x34,
    0x00,
    0x00,
    0xcf,
    0x30,
    0x00,
    0x00,
    0xd3,
    0x2c,
    0x00,
    0x00,
    0xd7,
    0x28,
    0x00,
    0x00,
    0xdb,
    0x24,
    0x00,
    0x00,
    0xdf,
    0x20,
    0x00,
    0x00,
    0xe3,
    0x1c,
    0x00,
    0x00,
    0xe7,
    0x18,
    0x00,
    0x00,
    0xeb,
    0x14,
    0x00,
    0x00,
    0xef,
    0x10,
    0x00,
    0x00,
    0xf3,
    0x0c,
    0x00,
    0x00,
    0xf7,
    0x08,
    0x00,
    0x00,
    0xfb,
    0x04,
    0x00,
    0x00,

};

void AD9110_IOInit(void)
{
//  GPIO_InitTypeDef GPIO_InitStructure;

//  __HAL_RCC_GPIOA_CLK_ENABLE();
//  __HAL_RCC_GPIOC_CLK_ENABLE();
//  __HAL_RCC_GPIOD_CLK_ENABLE();

//  GPIO_InitStructure.Pin = GPIO_PIN_9 | GPIO_PIN_10 | GPIO_PIN_11 | GPIO_PIN_12;
//  GPIO_InitStructure.Mode = GPIO_MODE_OUTPUT_PP;
//  GPIO_InitStructure.Speed = GPIO_SPEED_FREQ_VERY_HIGH;
//  GPIO_InitStructure.Pull = GPIO_PULLUP;
//  HAL_GPIO_Init(GPIOD, &GPIO_InitStructure);

//  GPIO_InitStructure.Pin = GPIO_PIN_6 | GPIO_PIN_7 | GPIO_PIN_11 | GPIO_PIN_12;
//  HAL_GPIO_Init(GPIOC, &GPIO_InitStructure);

//  GPIO_InitStructure.Pin = GPIO_PIN_0 | GPIO_PIN_3 | GPIO_PIN_5;
//  HAL_GPIO_Init(GPIOD, &GPIO_InitStructure);
}

//=====================================================================

//======================发送8位数据程序===================================
void txd_8bit(uchar txdat)
{
  uchar i, sbt;
  sbt = 0x80;
  AD9910_SCLK(0);
  for (i = 0; i < 8; i++)
  {
    if ((txdat & sbt) == 0)
      AD9910_SDIO(0);
    else
      AD9910_SDIO(1);
    AD9910_SCLK(1);
    sbt = sbt >> 1;
    AD9910_SCLK(0);
  }
}

//======================ad9910初始化程序================================
void Init_ad9910(void)
{
  uchar k, m;

  AD9110_IOInit(); //IO初始化
  AD9910_PWR(0);  //软件拉低

  AD9910_PROFILE2(0);
  AD9910_PROFILE1(0);
  AD9910_PROFILE0(0);
  AD9910_DRCTL(0);
  AD9910_DRHOLD(0);
  AD9910_MAS_REST(1);
  Delay_ms(5);
  AD9910_MAS_REST(0);

  AD9910_CS(0);
  txd_8bit(0x00); //发送CFR1控制字地址
  for (m = 0; m < 4; m++)
    txd_8bit(cfr1[m]);
  AD9910_CS(1);
  for (k = 0; k < 10; k++)
    ;

  AD9910_CS(0);
  txd_8bit(0x01); //发送CFR2控制字地址
  for (m = 0; m < 4; m++)
    txd_8bit(cfr2[m]);
  AD9910_CS(1);
  for (k = 0; k < 10; k++)
    ;

  AD9910_CS(0);
  txd_8bit(0x02); //发送CFR3控制字地址
  for (m = 0; m < 4; m++)
    txd_8bit(cfr3[m]);
  AD9910_CS(1);
  for (k = 0; k < 10; k++)
    ;

  AD9910_UP_DAT(1);
  for (k = 0; k < 10; k++)
    ;
  AD9910_UP_DAT(0);
  Delay_ms(1);
}

//======================发送cfr控制字====================================
void Txcfr(void)
{
  uchar k, m;

  AD9910_CS(0);
  txd_8bit(0x00); //发送CFR1控制字地址
  for (m = 0; m < 4; m++)
    txd_8bit(cfr1[m]);
  AD9910_CS(1);
  for (k = 0; k < 10; k++)
    ;

  AD9910_CS(0);
  txd_8bit(0x01); //发送CFR2控制字地址
  for (m = 0; m < 4; m++)
    txd_8bit(cfr2[m]);
  AD9910_CS(1);
  for (k = 0; k < 10; k++)
    ;

  AD9910_CS(0);
  txd_8bit(0x02); //发送CFR3控制字地址
  for (m = 0; m < 4; m++)
    txd_8bit(cfr3[m]);
  AD9910_CS(1);
  for (k = 0; k < 10; k++)
    ;

  AD9910_UP_DAT(1);
  for (k = 0; k < 10; k++)
    ;
  AD9910_UP_DAT(0);
  Delay_ms(1);
}
//=====================================================================

//======================ad9910发送profile0控制字程序===================================
void Txprodile0(void)
{
  uchar m;

  AD9910_CS(0);
  txd_8bit(0x0e); //发送profile0控制字地址
  for (m = 0; m < 8; m++)
    txd_8bit(profile11[m]);
  AD9910_CS(1);
  // for(k=0;k<10;k++);

  AD9910_UP_DAT(1);
  // for(k=0;k<10;k++);
  AD9910_UP_DAT(0);
  // Delay_ms(1);
}
//=====================================================================
//===================计算频偏字、频率字和发送程序======================
void Freq_convert(ulong Freq)
{
  ulong Temp;
  Temp = (ulong)Freq * 4.294967296; //将输入频率因子分为四个字节  4.294967296=(2^32)/1000000000
  profile11[7] = (uchar)Temp;
  profile11[6] = (uchar)(Temp >> 8);
  profile11[5] = (uchar)(Temp >> 16);
  profile11[4] = (uchar)(Temp >> 24);
  Txprodile0();
}

/*------------------------------------------------------------------------------
* brief   : 计算正弦波幅值(Vpp)和发送程序
* EntryParameter: Amp设定的幅值,设定值在1~649之间
-------------------------------------------------------------------------------*/
void Amp_convert(uint Amp)
{
  ulong Temp;
  Temp = (ulong)Amp * 28.4829; //将输入幅度因子分为两个字节  25.20615385=(2^14)/650
  if (Temp > 0x3fff)
    Temp = 0x3fff;
  Temp &= 0x3fff;
  profile11[1] = (uchar)Temp;
  profile11[0] = (uchar)(Temp >> 8);
  Txprodile0();
}

//======================ad9910发送DRG参数程序==================================
void Txdrg(void)
{
  uchar m, k;

  AD9910_CS(0);
  txd_8bit(0x0b); //发送数字斜坡限制地址0x0b
  for (m = 0; m < 8; m++)
    txd_8bit(drgparameter[m]);
  AD9910_CS(1);
  for (k = 0; k < 10; k++)
    ;

  AD9910_CS(0);
  txd_8bit(0x0c); //发送数字斜坡步长地址0x0c
  for (m = 8; m < 16; m++)
    txd_8bit(drgparameter[m]);
  AD9910_CS(1);
  for (k = 0; k < 10; k++)
    ;

  AD9910_CS(0);
  txd_8bit(0x0d); //发送数字斜坡速率地址0x0d
  for (m = 16; m < 20; m++)
    txd_8bit(drgparameter[m]);
  AD9910_CS(1);
  for (k = 0; k < 10; k++)
    ;

  AD9910_UP_DAT(1);
  for (k = 0; k < 10; k++)
    ;
  AD9910_UP_DAT(0);
  Delay_ms(1);
}

//=====================扫频波参数设置和发送程序===================================
void SweepFre(ulong SweepMinFre, ulong SweepMaxFre, ulong SweepStepFre, ulong SweepTime)
{
  ulong Temp1, Temp2, ITemp3, DTemp3, ITemp4, DTemp4;
  Temp1 = (ulong)SweepMinFre * 4.294967296;
  if (SweepMaxFre > 400000000)
    SweepMaxFre = 400000000;
  Temp2 = (ulong)SweepMaxFre * 4.294967296;
  if (SweepStepFre > 400000000)
    SweepStepFre = 400000000;
  ITemp3 = (ulong)SweepStepFre * 4.294967296;
  DTemp3 = ITemp3;
  ITemp4 = (ulong)SweepTime / 4; //1GHz/4, 单位：ns
  if (ITemp4 > 0xffff)
    ITemp4 = 0xffff;
  DTemp4 = ITemp4;

  //扫频上下限
  drgparameter[7] = (uchar)Temp1;
  drgparameter[6] = (uchar)(Temp1 >> 8);
  drgparameter[5] = (uchar)(Temp1 >> 16);
  drgparameter[4] = (uchar)(Temp1 >> 24);
  drgparameter[3] = (uchar)Temp2;
  drgparameter[2] = (uchar)(Temp2 >> 8);
  drgparameter[1] = (uchar)(Temp2 >> 16);
  drgparameter[0] = (uchar)(Temp2 >> 24);
  //频率步进（单位：Hz）
  drgparameter[15] = (uchar)ITemp3;
  drgparameter[14] = (uchar)(ITemp3 >> 8);
  drgparameter[13] = (uchar)(ITemp3 >> 16);
  drgparameter[12] = (uchar)(ITemp3 >> 24);
  drgparameter[11] = (uchar)DTemp3;
  drgparameter[10] = (uchar)(DTemp3 >> 8);
  drgparameter[9] = (uchar)(DTemp3 >> 16);
  drgparameter[8] = (uchar)(DTemp3 >> 24);
  //步进时间间隔（单位：us）
  drgparameter[19] = (uchar)ITemp4;
  drgparameter[18] = (uchar)(ITemp4 >> 8);
  drgparameter[17] = (uchar)DTemp4;
  drgparameter[16] = (uchar)(DTemp4 >> 8);
  //发送DRG参数
  Txdrg();
  cfr1[0] = 0x00; //RAM 失能
  cfr2[1] = 0x0e; //DRG 使能
  Txcfr();        //发送cfrx控制字
}

//==========================发送ramprofile0控制字=============================
void Txramprofile(void)
{
  uchar m, k;

  AD9910_CS(0);
  txd_8bit(0x0e); //发送ramprofile0控制字地址
  for (m = 0; m < 8; m++)
    txd_8bit(ramprofile0[m]);
  AD9910_CS(1);
  for (k = 0; k < 10; k++)
    ;

  AD9910_UP_DAT(1);
  for (k = 0; k < 10; k++)
    ;
  AD9910_UP_DAT(0);
  Delay_ms(1);
}
void Tx32bite(uint32_t data){
	txd_8bit((u8) (data>>24));
	txd_8bit((u8) (data>>16));
	txd_8bit((u8) (data>>8));
	txd_8bit((u8) (data));
}
void TxRAMFM(void){
	uint m, k;
    AD9910_CS(0);
    txd_8bit(0x16); //发送ram控制字地址
    for (m = 0; m < 500; m++)
      Tx32bite(RAM_TEXT_FM[m]);
    AD9910_CS(1);
    for (k = 0; k < 10; k++)
      ;
    AD9910_UP_DAT(1);
    for (k = 0; k < 10; k++)
      ;
    AD9910_UP_DAT(0);
    Delay_ms(1);
}

//=======================发送方波、锯齿波波形程序=============================
void Txramdata(int wave_num)
{

  if (wave_num == 1)
  {
    uint m, k;
    AD9910_CS(0);
    txd_8bit(0x16); //发送ram控制字地址
    for (m = 0; m < 4096; m++)
      txd_8bit(ramdata_Square[m]);
    AD9910_CS(1);
    for (k = 0; k < 10; k++)
      ;
    AD9910_UP_DAT(1);
    for (k = 0; k < 10; k++)
      ;
    AD9910_UP_DAT(0);
    Delay_ms(1);
  }
  else
  {
    uint m, k;
    AD9910_CS(0);
    txd_8bit(0x16); //发送ram控制字地址
    for (m = 0; m < 4096; m++)
      txd_8bit(ramdata_Sawtooth[m]);
    AD9910_CS(1);
    for (k = 0; k < 10; k++)
      ;
    AD9910_UP_DAT(1);
    for (k = 0; k < 10; k++)
      ;
    AD9910_UP_DAT(0);
    Delay_ms(1);
  }
}

//========================产生方波的程序======================================
void Square_wave(uint Sample_interval)
{
  ulong Temp;

  Temp = ((1000000000 / (unsigned long int)(Sample_interval) / 64 / 4)); //1GHz/4, 采样间隔范围：4*(1~65536)ns
  if (Temp > 0xffff)
    Temp = 0xffff;
  ramprofile0[7] = 0x24;
  ramprofile0[6] = 0x00;
  ramprofile0[5] = 0x00;
  ramprofile0[4] = 0xc0;
  ramprofile0[3] = 0x0f;
  ramprofile0[2] = (uchar)Temp;
  ramprofile0[1] = (uchar)(Temp >> 8);
  ramprofile0[0] = 0x00;
  Txramprofile();
  Txramdata(1);
  cfr1[0] = 0xc0; //RAM 使能，幅度控制
  cfr2[1] = 0x00; //DRG 失能
  Txcfr();        //发送cfrx控制字
}

//========================产生锯齿波的程序=====================================
void Sawtooth_wave(uint Sample_interval)
{
  ulong Temp;

  Temp = ((1000000000 / (unsigned long int)(Sample_interval) / 64 / 4)); //1GHz/4, 采样间隔范围：4*(1~65536)ns
  if (Temp > 0xffff)
    Temp = 0xffff;
  ramprofile0[7] = 0x24;
  ramprofile0[6] = 0x00;
  ramprofile0[5] = 0x00;
  ramprofile0[4] = 0xc0;
  ramprofile0[3] = 0x0f;
  ramprofile0[2] = (uchar)Temp;
  ramprofile0[1] = (uchar)(Temp >> 8);
  ramprofile0[0] = 0x00;
  Txramprofile();
  Txramdata(0);
  cfr1[0] = 0xc0; //RAM 使能，幅度控制
  cfr2[1] = 0x00; //DRG 失能
  Txcfr();        //发送cfrx控制字
}

void Set_RefCLK_OUT(uint8_t mode)
{

  AD9910_CS(0);
  txd_8bit(0x02);

  AD9910_CS(1);
}

void AD9910_ram_Init(void){
	u8 m;
	u8 k;
	cfr1[0]=0x00;
	cfr1[1]=0x00;
	cfr1[2]=0x00;
	cfr1[3]=0x00;
	Txcfr();//RAM reset
	AD9910_PROFILE0(0);
	AD9910_PROFILE1(0);
	AD9910_PROFILE2(0);
	
	
	
	 AD9910_CS(0);
  txd_8bit(0x02); //发送CFR3控制字地址
  for (m = 0; m < 4; m++)
    txd_8bit(cfr3[m]);
  AD9910_CS(1);
  for (k = 0; k < 10; k++)
    ;
	
	
	
	//RAMprofile0
	ramprofile0[0]=0x08;
	ramprofile0[1]=0x00;
	ramprofile0[2]=0x32;//0x32
	ramprofile0[3]=0x7C;
	ramprofile0[4]=0xC0;//ADDRESS 499
	ramprofile0[5]=0x00;
	ramprofile0[6]=0x00;
	ramprofile0[7]=0x24;
	Txramprofile();//Write ram profile
	TxRAMFM();//write data of ram 
	cfr1[0]=0x80;// RAM OPEN    FRE MOD OPEN 
	cfr1[1]=0x40;
	cfr2[1] = 0x00; //DRG 失能
	Txcfr();        //发送cfrx控制字
	
}



/*-----------------------  PERSONAL --------------------------------------*/

void FM_DATA_GET(ulong FRE_CAR){
	
	ulong CRE_FRE=0;
	uint16_t i;
	uint32_t val;
	CRE_FRE=FRE_CAR*4.294967296;
	val=CRE_FRE-RAM_TEXT_FM[0];
	for(i=0;i<500;i++){
		RAM_TEXT_FM[i]+=val;
	}
}